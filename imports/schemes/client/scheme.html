<template name="schemes">

<h1>List of your schemes:</h1>
<ul>
{{#each s in schemeList}}
  <li>
    <A href="{{flowPath 'scheme' s._id}}">{{s.name}} ver: </A> {{s.version}}

  </li>
{{/each}}
</ul>
<button id="create-scheme">New Scheme</button>
</template>


<template name="simulationResolution">

    <h3>Simulation Resolution:</h3>
      <select id="resolution">
        <option value="custom">Custom</option>
        <option {{isSelected "draft" convergence_chunk_size convergence_fewest_plants convergence_tolerance}} value="draft">Draft (Very Low)</option>
        <option {{isSelected "low" convergence_chunk_size convergence_fewest_plants convergence_tolerance}} value="low">Low</option>
        <option {{isSelected "high" convergence_chunk_size convergence_fewest_plants convergence_tolerance}} value="high">High</option>
		</select>


      <div><h4>Chunk Size:</h4> <input id="chunk-size" value="{{convergence_chunk_size}}"/></div>
      <div><h4>Tolerance:</h4>  <input id="tolerance" value="{{convergence_tolerance}}"/></div>
      <div><h4>Fewest Plants:</h4> <input id="min-plants" value="{{convergence_fewest_plants}}"/></div>

</template>

<template name="plant">
  <div class="teal-item">
  <h3 class="item-title inline-h"> Parent name:</h3> <input class="parent-name" value="{{plant.name}}"/>
  <div class="pull-right">
  <button class="btn btn-danger delete-parent"><i class="fa fa-trash-o fa-lg"></i></button>
  </div>

  <div class="orange-title">
    <h4 class="orange-title">
      Loci:
    </h4>
  </div>
  <div class="orange-list">
  <table>
    {{#if plant.loci}}
    <tr>
      <th>Name:</th>
      <th>Type</th>
      <th>Linkage Group /<br/>
       Chromosome</th>
      <th>Position</th>
      <th></th>
    </tr>
    {{/if}}
    {{#each l in plant.loci}}
      {{> loci loci=l li=@index pi=pi}}
    {{/each}}

    </table>
    <div class="orange-item">
      <button class="btn btn-info add-locus"><i class="fa fa-plus"></i> Add Locus</button>
    </div>
  </div>
  </div>
</template>

<template name="loci">
  <tr>
    <td><input class="loci-name" placeholder="locus name" value="{{loci.name}}"/></td>
    <td><select class="loci-type">
      <option {{isSelected loci.type "Trait"}} value="Trait">Target Gene</option>
      <option {{isSelected loci.type "Marker"}} value="Marker">Marker</option>
    <!--{{loci.type}}-->
    </select></td>

    <td><input class="linkage-group" style="width:5em;" type="number" min=1
               max={{linkageGroupMax}}
               placeholder="1-{{linkageGroupMax}}"
               value = {{loci.linkage_group}} /></td>
    <td><input class="position" style="width:5em;" type="number" min=1
               placeholder="1-{{positionMax loci.linkage_group}}"
               max={{positionMax loci.linkage_group}}
               value = {{loci.position}} /></td>
    <td><button class="btn btn-danger delete-loci"><i class="fa fa-trash-o fa-lg"></i></button></td>

  </tr>
</template>

<template name="cross">
  <tr>
    <td><input class="cross-name" value="{{cross.name}}"></td>
    <td><select class="rparent" >
      <option {{isSelected cross.right null}} disabled>select parent:</option>
      <optgroup label = "Parents">
        {{#each o in optionsPlantsForSelect}}
          <option {{isSelected o cross.right}}>{{o}}</option>
        {{/each}}
      </optgroup>
      <optgroup label = "Crosses">
        {{#each o in optionsCrossesForSelect cross}}
          <option {{isSelected o cross.right}}>{{o}}</option>
        {{/each}}
      </optgroup>
    </select>
    </td>
    <td><select class="lparent" >
      <option {{isSelected cross.left null}} disabled>select parent:</option>
      <optgroup label = "Parents">
        {{#each o in optionsPlantsForSelect}}
          <option {{isSelected o cross.left}}>{{o}}</option>
        {{/each}}
      </optgroup>
      <optgroup label = "Crosses">
        {{#each o in optionsCrossesForSelect cross}}
          <option {{isSelected o cross.left}}>{{o}}</option>
        {{/each}}
      </optgroup>
    </select>
    </td>
    <td><select class="zygosity">
      <option {{isSelected cross.zygosity "Homozygous"}} value="Homozygous">Homozygous</option>
      <option {{isSelected cross.zygosity "Heterozygous"}} value="Heterozygous">Heterozygous</option>
    </select>
    </td>
    <td class="crossLociCell">
    {{#each l in cross.loci}}
      {{> crossLoci loci=l ci=ci}}
    {{/each}}
    </td>
    <td>
    <select class="add-loci">
    <option selected disabled value="default">Add:</option>
    {{#each l in optionsAvailableLoci cross}}
    <option>
      {{l.name}}
    </option>
    {{/each}}
    <option value="add-all-ZTU2YTdkODc4Njk0NDk0NGNhNzc5ZjFi">
      Add All
    </option>
    </select>
    </td>
    <td>

    <button class="btn btn-danger delete-cross"><i class="fa fa-trash-o fa-lg"></i></button>
    </td>
  </tr>
</template>

<template name="crossLoci">
  <span class="label label-danger"> {{loci}} <i class="delete-loci fa fa-trash-o fa-lg"></i></span>
</template>

<template name="chart">
  <div class="teal-item">
    <h3> Chart {{plusOne chi}} </h3>
    <select class="chart-type">
      <option value="success_table"
      {{isSelected chart.type "success_table"}}>Success Table</option>
      <option value="loci_composition"
      {{isSelected chart.type "loci_composition"}}>Loci Composition</option>
      <option value="proportion_distribution"
      {{isSelected chart.type "proportion_distribution"}}>Proportion Distribution</option>
      <option value="mean_cross_composition"
      {{isSelected chart.type "mean_cross_composition"}}>Mean Cross Composition</option>
      <option value="custom"
      {{isSelected chart.type "custom"}}>Custom</option>
    </select>

    {{#if $eq chart.type "loci_composition"}}
      <select class="loci-composition">
        <option></option>
        {{#each cross in all_crosses}}
          <option {{isSelected parsed_data.cross cross}}>{{cross}}</option>
        {{/each}}
      </select>
    {{/if}}

    {{#if $eq chart.type "success_table"}}
      {{#each stable in parsed_data.require}}
        {{> successTable data=parsed_data stable=stable chi=chi si=@index}}
      {{/each}}

      <button class="success-table-add"> + </button>
    {{/if}}

    {{#if $eq chart.type "proportion_distribution"}}
    Donor:

      <select class="proportion-distribution-donor">
        <option></option>
        {{#each donor in all_plants}}
          <option {{isSelected parsed_data.donor donor}}>{{donor}}</option>
        {{/each}}
      </select>

    Cross:
      <select class="proportion-distribution-cross">
        <option></option>
        {{#each cross in all_crosses}}
          <option {{isSelected parsed_data.cross cross}}>{{cross}}</option>
        {{/each}}
      </select>


    {{/if}}

    {{#if $eq chart.type "mean_cross_composition"}}
      <select multiple="" class="mean-cross-data">
      {{#each cross in all_crosses}}
        <option {{isSelectedSet parsed_data.crosses cross}}>{{cross}}</option>
      {{/each}}
      </select>
    {{/if}}

    {{#unless custom_type chart.type}}
      <input value="{{chart.type}}" class="chart-type-custom" />
      <input value="{{chart.data}}" class="chart-data-custom" />
    {{/unless}}
  <div class="pull-right">
    <button class="btn btn-danger chart-delete"><i class="fa fa-trash-o fa-lg"></i></button>
  </div>
  </div>



</template>

<template name="successTable">
<div>
  <select class="stable-cross">
    <option></option>
    {{#each cross in all_crosses}}
      <option {{isSelected stable.cross cross}}>{{cross}}</option>
    {{/each}}
  </select>
  <input class="stable-quantity" value="{{stable.quantity}}"/>
  <input class="stable-confidence" value="{{stable.confidence}}"/>
  <button class="btn btn-danger stable-delete"><i class="fa fa-trash-o fa-lg"></i></button>
</div>
</template>

<template name="scheme">
{{#if Template.subscriptionsReady}}
<div class="row">
<div class="col-md-12">
  <h1>Edit Scheme: <input id="scheme-name" value="{{scheme.name}}"/></h1>

  <div class="teal-title">
    <h1 class="teal-title">Config</h1>
  </div>

  <div id="config" class="teal-no-item teal-list">
    <h3 >Species:</h3>
		<select id="species">
			{{#each species in speciesList}}
			<option value='{{species.value}}'
				{{isSelected species.name scheme.species.name}}
			>{{species.name}}</option>

			{{/each}}
		</select>

      {{> simulationResolution scheme.system }}

  </div>

  <div class="teal-title">
    <h1 class="teal-title">Parents</h1>
  </div>
  <div class="teal-list">

    {{#each p in scheme.plants}}
      {{> plant plant=p pi=@index}}
    {{/each}}
    <div class="teal-item">
      <button id="add-parent" class="btn btn-info">+ add parent</button>
    </div>
  </div>

  <div class="teal-title">
    <h1 class="teal-title">Crosses</h1>
  </div>

  <div class="teal-list">
  <table class="teal-list">
  <thead>
    {{#if scheme.crosses}}
    <tr>
    <th>Name:</th>
    <th><i class="fa fa-mars"></i> Parent:</th>
    <th><i class="fa fa-venus"></i> Parent:</th>
    <th>Selection Zygosity</th>
    <th>Loci To Select For:</th>
    </tr>
    {{/if}}
  </thead>
  <tbody>
    {{#each c in scheme.crosses}}
      {{> cross cross=c ci=@index}}
    {{/each}}

    <tr>
    <td>
      <button id="add-cross" class="btn btn-info">+ add cross</button>
    </td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    </tr>
  </tbody>
  </table>
  </div>
  <div class="teal-title">
    <h1 class="teal-title">Charts</h1>
  </div>
  <div class="teal-list">
    {{#each o in scheme.outputs}}
      {{> chart chart=o chi=@index}}
    {{/each}}
    <div class="teal-item">
      <button id="add-chart" class="btn btn-info">+ add chart</button>
    </div>
  </div>
  <br/>
  <br/>

  <button class="btn btn-primary" id="backup">Backup</button>
  <button class="btn btn-primary" id="revert">Revert</button>
  <button class="btn btn-primary" id="process">Backup & Process</button>

  <br/>
  <br/>
  <br/>
  <br/>
</div>
</div>
{{/if}}
</template>
